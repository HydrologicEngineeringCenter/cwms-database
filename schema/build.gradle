buildscript {
    dependencies {
        classpath "com.oracle.database.jdbc:ojdbc8:$ORACLE_JDBC_VERSION"
    }

}

plugins {
    id 'java'
    id 'org.flywaydb.flyway' version '8.4.4'
}

configurations {
    compile
    flywayMigration
}

dependencies {
    implementation "org.flywaydb:flyway-core:8.4.4"
    compile "org.flywaydb:flyway-core:8.4.4"
    flywayMigration "com.oracle.database.jdbc:ojdbc8:$ORACLE_JDBC_VERSION"
    flywayMigration sourceSets.main.runtimeClasspath
}

flyway {
    locations = ["db/migration"]
    configurations = ['flywayMigration','compile','runtimeClasspath']
    /*url = "$DB_URL"
    user = BUILD_USER
    password = BUILD_USERPASSWORD*/
    resolvers =  ['cwms.resolvers.DependsOnPackageResolver']
    mixed = true
    schemas = ['CWMS_20','CWMS_DBA']
    placeholders = [
        "CWMS_SCHEMA": "CWMS_20",
        "CWMS_SCHEMA_AUTH": "no authentication", // override on commandline with identified by portion if needed.
        "CWMS_DBA_AUTH": "no authentication",
        "CWMS_TABLESPACE": "CWMS_20DATA",
        "AT_TABLESPACE": "CWMS_20ATDATA",
        "AQ_TABLESPACE": "CWMS_AQ",
        "AQ_EX_TABLESPACE": "CWMS_AQ_EX"
    ]
}

flywayMigrate.dependsOn classes
flywayClean.dependsOn classes
flywayRepair.dependsOn classes