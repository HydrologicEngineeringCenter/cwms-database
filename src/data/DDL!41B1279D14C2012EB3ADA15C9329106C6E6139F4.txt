
  CREATE TABLE "CWMS_20"."CWMS_BASE_PARAMETER" 
   (	"BASE_PARAMETER_CODE" NUMBER(10,0) NOT NULL ENABLE, 
	"BASE_PARAMETER_ID" VARCHAR2(16) NOT NULL ENABLE, 
	"ABSTRACT_PARAM_CODE" NUMBER(10,0) NOT NULL ENABLE, 
	"UNIT_CODE" NUMBER(10,0) NOT NULL ENABLE, 
	"DISPLAY_UNIT_CODE_SI" NUMBER(10,0) NOT NULL ENABLE, 
	"DISPLAY_UNIT_CODE_EN" NUMBER(10,0) NOT NULL ENABLE, 
	"LONG_NAME" VARCHAR2(80), 
	"DESCRIPTION" VARCHAR2(160), 
	 CONSTRAINT "CWMS_BASE_PARAMETER_PK" PRIMARY KEY ("BASE_PARAMETER_CODE")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT)
  TABLESPACE "CWMS_20DATA"  ENABLE, 
	 CONSTRAINT "CWMS_BASE_PARAMETER_FK1" FOREIGN KEY ("ABSTRACT_PARAM_CODE")
	  REFERENCES "CWMS_20"."CWMS_ABSTRACT_PARAMETER" ("ABSTRACT_PARAM_CODE") ENABLE, 
	 CONSTRAINT "CWMS_BASE_PARAMETER_FK2" FOREIGN KEY ("UNIT_CODE")
	  REFERENCES "CWMS_20"."CWMS_UNIT" ("UNIT_CODE") ENABLE, 
	 CONSTRAINT "CWMS_BASE_PARAMETER_FK3" FOREIGN KEY ("DISPLAY_UNIT_CODE_SI")
	  REFERENCES "CWMS_20"."CWMS_UNIT" ("UNIT_CODE") ENABLE, 
	 CONSTRAINT "CWMS_BASE_PARAMETER_FK4" FOREIGN KEY ("DISPLAY_UNIT_CODE_EN")
	  REFERENCES "CWMS_20"."CWMS_UNIT" ("UNIT_CODE") ENABLE
   ) PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 204800 NEXT 204800 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT)
  TABLESPACE "CWMS_20DATA" 
 
  CREATE UNIQUE INDEX "CWMS_20"."CWMS_BASE_PARAMETER_UI" ON "CWMS_20"."CWMS_BASE_PARAMETER" (UPPER("BASE_PARAMETER_ID")) 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 204800 NEXT 204800 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT)
  TABLESPACE "CWMS_20DATA" 
 
  CREATE UNIQUE INDEX "CWMS_20"."CWMS_BASE_PARAMETER_PK" ON "CWMS_20"."CWMS_BASE_PARAMETER" ("BASE_PARAMETER_CODE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT)
  TABLESPACE "CWMS_20DATA" 
 
  CREATE OR REPLACE TRIGGER "CWMS_20"."CWMS_BASE_PARAMETER_UNIT" 
   BEFORE INSERT OR UPDATE OF abstract_param_code, unit_code
   ON cwms_base_parameter
   REFERENCING NEW AS NEW OLD AS OLD
   FOR EACH ROW
DECLARE
   --
   -- This trigger ensures that the abstract parameter associated with the specified
   -- unit is the same as the abstract parameter associated with this parameter.
   --
   unit_abstract_code            cwms_abstract_parameter.abstract_param_code%TYPE;
   unit_abstract_id              cwms_abstract_parameter.abstract_param_id%TYPE;
   unit_id                       cwms_unit.unit_id%TYPE;
   unit_type                     VARCHAR (20);
   parameter_abstract_id         cwms_abstract_parameter.abstract_param_id%TYPE;
   inconsistent_abstract_codes   EXCEPTION;
   PRAGMA EXCEPTION_INIT (inconsistent_abstract_codes, -20000);
BEGIN
   SELECT u.abstract_param_code
     INTO unit_abstract_code
     FROM cwms_unit u
    WHERE u.unit_code = :NEW.unit_code;

   IF :NEW.abstract_param_code != unit_abstract_code
   THEN
      SELECT u.unit_id
        INTO unit_id
        FROM cwms_unit u
       WHERE u.unit_code = :NEW.unit_code;

      unit_type := 'DB Storage Unit';
      RAISE inconsistent_abstract_codes;
   END IF;

   --
   SELECT u.abstract_param_code
     INTO unit_abstract_code
     FROM cwms_unit u
    WHERE u.unit_code = :NEW.display_unit_code_si;

   IF :NEW.abstract_param_code != unit_abstract_code
   THEN
      SELECT u.unit_id
        INTO unit_id
        FROM cwms_unit u
       WHERE u.unit_code = :NEW.display_unit_code_si;

      unit_type := 'SI Display Unit';
      RAISE inconsistent_abstract_codes;
   END IF;

   --
   SELECT u.abstract_param_code
     INTO unit_abstract_code
     FROM cwms_unit u
    WHERE u.unit_code = :NEW.display_unit_code_en;

   IF :NEW.abstract_param_code != unit_abstract_code
   THEN
      SELECT u.unit_id
        INTO unit_id
        FROM cwms_unit u
       WHERE u.unit_code = :NEW.display_unit_code_en;

      unit_type := 'Non-SI Display Unit';
      RAISE inconsistent_abstract_codes;
   END IF;
EXCEPTION
   WHEN inconsistent_abstract_codes
   THEN
      SELECT abstract_param_id
        INTO unit_abstract_id
        FROM cwms_abstract_parameter
       WHERE abstract_param_code = unit_abstract_code;

      SELECT abstract_param_id
        INTO parameter_abstract_id
        FROM cwms_abstract_parameter
       WHERE abstract_param_code = :NEW.abstract_param_code;

      DBMS_OUTPUT.put_line (   'ERROR: Parameter "'
                            || :NEW.base_parameter_id
                            || '" has abstract parameter "'
                            || parameter_abstract_id
                            || '" but '
                            || unit_type
                            ||  ' "'
                            || unit_id
                            || '" has abstract parameter "'
                            || unit_abstract_id
                            || '".'
                           );
      RAISE;
   WHEN OTHERS
   THEN
      DBMS_OUTPUT.put_line (SQLERRM);
      RAISE;
END r_parameter_unit;
ALTER TRIGGER "CWMS_20"."CWMS_BASE_PARAMETER_UNIT" ENABLE
 