
  CREATE TABLE "CWMS_20"."AT_UNIT_ALIAS" 
   (	"ALIAS_ID" VARCHAR2(32) NOT NULL ENABLE, 
	"DB_OFFICE_CODE" NUMBER NOT NULL ENABLE, 
	"UNIT_CODE" NUMBER(10,0) NOT NULL ENABLE, 
	 CONSTRAINT "AT_UNIT_ALIAS_PK" PRIMARY KEY ("ALIAS_ID", "DB_OFFICE_CODE")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT)
  TABLESPACE "CWMS_20DATA"  ENABLE, 
	 CONSTRAINT "AT_UNIT_ALIAS_R02" FOREIGN KEY ("DB_OFFICE_CODE")
	  REFERENCES "CWMS_20"."CWMS_OFFICE" ("OFFICE_CODE") ENABLE, 
	 CONSTRAINT "FK_AT_UNIT_ALIAS" FOREIGN KEY ("UNIT_CODE")
	  REFERENCES "CWMS_20"."CWMS_UNIT" ("UNIT_CODE") ENABLE
   ) PCTFREE 10 PCTUSED 0 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING
  STORAGE(INITIAL 204800 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT)
  TABLESPACE "CWMS_20AT_DATA" 
 
  CREATE UNIQUE INDEX "CWMS_20"."AT_UNIT_ALIAS_PK" ON "CWMS_20"."AT_UNIT_ALIAS" ("ALIAS_ID", "DB_OFFICE_CODE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT)
  TABLESPACE "CWMS_20DATA" 
 
  CREATE OR REPLACE TRIGGER "CWMS_20"."AT_UNIT_ALIAS_CONSTRAINT" 
before delete or update
of alias_id
on "CWMS_20"."AT_UNIT_ALIAS"
referencing new as new old as old
for each row
declare
   l_count number;
begin
   if deleting or (updating and :new.alias_id != :old.alias_id) then
      select count(unit_id)
        into l_count
        from at_xchg_dss_ts_mappings m,
             at_cwms_ts_spec         ts,
             at_physical_location    pl,
             at_base_location        bl,
             cwms_office             o
       where m.unit_id = :old.alias_id
         and ts.ts_code = m.cwms_ts_code
         and pl.location_code = ts.location_code
         and bl.base_location_code = pl.base_location_code
         and o.office_code = bl.db_office_code
         and o.office_code = :old.db_office_code;
      if l_count > 0 then
         cwms_err.raise(
            'cannot_delete_unit_1',
            :old.alias_id,
            ''|| l_count || 'dss time series specification(s)');
      end if;
   end if;
end at_unit_alias_constraint;
ALTER TRIGGER "CWMS_20"."AT_UNIT_ALIAS_CONSTRAINT" ENABLE
 